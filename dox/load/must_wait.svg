<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="694pt" height="764pt" viewBox="0 0 694.12 764"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 760)"><title>dilemma</title><polygon fill="#fff" stroke="none" points="-4 4 -4 -760 690.124 -760 690.124 4 -4 4"/><g id="node1" class="node"><title>A</title><polygon fill="none" stroke="#000" points="181.452 -756 133.452 -756 133.452 -720 187.452 -720 187.452 -750 181.452 -756"/><polyline fill="none" stroke="#000" points="181.452 -756 181.452 -750"/><polyline fill="none" stroke="#000" points="187.452 -750 181.452 -750"/><text x="160.452" y="-733.8" font-family="Times,serif" font-size="14" text-anchor="middle">A</text></g><g id="node7" class="node"><title>A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] // start</title><polygon fill="none" stroke="#000" points="320.855 -684 .048 -684 .048 -648 320.855 -648 320.855 -684"/><text x="160.452" y="-661.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] // start</text></g><g id="edge1" class="edge"><title>A-&gt;A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] // start</title><path fill="none" stroke="#000" d="M160.452,-719.697C160.452,-711.983 160.452,-702.712 160.452,-694.112"/><polygon fill="#000" stroke="#000" points="163.952 -694.104 160.452 -684.104 156.952 -694.104 163.952 -694.104"/></g><g id="node2" class="node"><title>B</title><polygon fill="none" stroke="red" points="533.452 -756 485.452 -756 485.452 -720 539.452 -720 539.452 -750 533.452 -756"/><polyline fill="none" stroke="red" points="533.452 -756 533.452 -750"/><polyline fill="none" stroke="red" points="539.452 -750 533.452 -750"/><text x="512.452" y="-733.8" font-family="Times,serif" font-size="14" text-anchor="middle">B</text></g><g id="node3" class="node"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // start</title><polygon fill="none" stroke="red" points="686.297 -684 338.607 -684 338.607 -648 686.297 -648 686.297 -684"/><text x="512.452" y="-661.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // start</text></g><g id="edge2" class="edge"><title>B-&gt;B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // start</title><path fill="none" stroke="red" d="M512.452,-719.697C512.452,-711.983 512.452,-702.712 512.452,-694.112"/><polygon fill="red" stroke="red" points="515.952 -694.104 512.452 -684.104 508.952 -694.104 515.952 -694.104"/></g><g id="node5" class="node"><title>B: add Foo(B) to #Foo waitqueue</title><polygon fill="none" stroke="red" points="538.549 -540 334.355 -540 334.355 -504 538.549 -504 538.549 -540"/><text x="436.452" y="-517.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: add Foo(B) to #Foo waitqueue</text></g><g id="edge3" class="edge"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // start-&gt;B: add Foo(B) to #Foo waitqueue</title><path fill="none" stroke="red" d="M503.284,-647.871C490.16,-623.35 465.905,-578.032 450.506,-549.259"/><polygon fill="red" stroke="red" points="453.456 -547.354 445.652 -540.189 447.285 -550.658 453.456 -547.354"/></g><g id="node4" class="node"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // end</title><polygon fill="none" stroke="red" points="608.407 -468 264.496 -468 264.496 -432 608.407 -432 608.407 -468"/><text x="436.452" y="-445.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // end</text></g><g id="node6" class="node"><title>B: [Foo new] **CRASH**</title><polygon fill="none" stroke="red" points="520.796 -396 352.107 -396 352.107 -360 520.796 -360 520.796 -396"/><text x="436.452" y="-373.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: [Foo new] **CRASH**</text></g><g id="edge5" class="edge"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // end-&gt;B: [Foo new] **CRASH**</title><path fill="none" stroke="red" d="M436.452,-431.697C436.452,-423.983 436.452,-414.712 436.452,-406.112"/><polygon fill="red" stroke="red" points="439.952 -406.104 436.452 -396.104 432.952 -406.104 439.952 -406.104"/></g><g id="edge4" class="edge"><title>B: add Foo(B) to #Foo waitqueue-&gt;B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] // end</title><path fill="none" stroke="red" d="M436.452,-503.697C436.452,-495.983 436.452,-486.712 436.452,-478.112"/><polygon fill="red" stroke="red" points="439.952 -478.104 436.452 -468.104 432.952 -478.104 439.952 -478.104"/></g><g id="node8" class="node"><title>A: add Foo</title><polygon fill="none" stroke="#000" points="363.952 -324 284.952 -324 284.952 -288 363.952 -288 363.952 -324"/><text x="324.452" y="-301.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: add Foo</text></g><g id="node9" class="node"><title>A: queue +[Foo load]</title><polygon fill="none" stroke="#000" points="304.989 -612 167.915 -612 167.915 -576 304.989 -576 304.989 -612"/><text x="236.452" y="-589.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: queue +[Foo load]</text></g><g id="edge7" class="edge"><title>A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] // start-&gt;A: queue +[Foo load]</title><path fill="none" stroke="#000" d="M179.238,-647.697C188.626,-639.05 200.136,-628.449 210.365,-619.027"/><polygon fill="#000" stroke="#000" points="212.897 -621.454 217.881 -612.104 208.155 -616.305 212.897 -621.454"/></g><g id="node10" class="node"><title>A: run #Foo waitqueue</title><polygon fill="none" stroke="#000" points="397.432 -252 251.471 -252 251.471 -216 397.432 -216 397.432 -252"/><text x="324.452" y="-229.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: run #Foo waitqueue</text></g><g id="edge12" class="edge"><title>A: add Foo-&gt;A: run #Foo waitqueue</title><path fill="none" stroke="#000" d="M324.452,-287.697C324.452,-279.983 324.452,-270.712 324.452,-262.112"/><polygon fill="#000" stroke="#000" points="327.952 -262.104 324.452 -252.104 320.952 -262.104 327.952 -262.104"/></g><g id="edge9" class="edge"><title>A: queue +[Foo load]-&gt;A: add Foo</title><path fill="none" stroke="#000" d="M236.335,-575.619C236.605,-545.591 239.263,-482.376 255.452,-432 267.271,-395.218 290.275,-356.89 306.463,-332.532"/><polygon fill="#000" stroke="#000" points="309.382 -334.464 312.086 -324.219 303.584 -330.542 309.382 -334.464"/></g><g id="node11" class="node"><title>A: add Foo(B)</title><polygon fill="none" stroke="#000" points="373.114 -180 275.789 -180 275.789 -144 373.114 -144 373.114 -180"/><text x="324.452" y="-157.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: add Foo(B)</text></g><g id="edge10" class="edge"><title>A: run #Foo waitqueue-&gt;A: add Foo(B)</title><path fill="none" stroke="#000" d="M324.452,-215.697C324.452,-207.983 324.452,-198.712 324.452,-190.112"/><polygon fill="#000" stroke="#000" points="327.952 -190.104 324.452 -180.104 320.952 -190.104 327.952 -190.104"/></g><g id="node12" class="node"><title>A: +[Foo load]</title><polygon fill="none" stroke="#000" points="374.561 -108 274.342 -108 274.342 -72 374.561 -72 374.561 -108"/><text x="324.452" y="-85.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: +[Foo load]</text></g><g id="edge13" class="edge"><title>A: add Foo(B)-&gt;A: +[Foo load]</title><path fill="none" stroke="#000" d="M324.452,-143.697C324.452,-135.983 324.452,-126.712 324.452,-118.112"/><polygon fill="#000" stroke="#000" points="327.952 -118.104 324.452 -108.104 320.952 -118.104 327.952 -118.104"/></g><g id="node13" class="node"><title>A: +[Foo(B) load]</title><polygon fill="none" stroke="#000" points="383.723 -36 265.18 -36 265.18 0 383.723 0 383.723 -36"/><text x="324.452" y="-13.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: +[Foo(B) load]</text></g><g id="edge14" class="edge"><title>A: +[Foo load]-&gt;A: +[Foo(B) load]</title><path fill="none" stroke="#000" d="M324.452,-71.6966C324.452,-63.9827 324.452,-54.7125 324.452,-46.1124"/><polygon fill="#000" stroke="#000" points="327.952 -46.104 324.452 -36.104 320.952 -46.104 327.952 -46.104"/></g></g></svg>