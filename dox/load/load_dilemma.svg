<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="586pt" height="764pt" viewBox="0 0 585.84 764"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 760)"><title>dilemma</title><polygon fill="#fff" stroke="none" points="-4 4 -4 -760 581.845 -760 581.845 4 -4 4"/><g id="node1" class="node"><title>A</title><polygon fill="none" stroke="#000" points="175.812 -756 127.812 -756 127.812 -720 181.812 -720 181.812 -750 175.812 -756"/><polyline fill="none" stroke="#000" points="175.812 -756 175.812 -750"/><polyline fill="none" stroke="#000" points="181.812 -750 175.812 -750"/><text x="154.812" y="-733.8" font-family="Times,serif" font-size="14" text-anchor="middle">A</text></g><g id="node3" class="node"><title>A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] start</title><polygon fill="none" stroke="#000" points="309.436 -684 .188 -684 .188 -648 309.436 -648 309.436 -684"/><text x="154.812" y="-661.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] start</text></g><g id="edge1" class="edge"><title>A-&gt;A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] start</title><path fill="none" stroke="#000" d="M154.812,-719.697C154.812,-711.983 154.812,-702.712 154.812,-694.112"/><polygon fill="#000" stroke="#000" points="158.312 -694.104 154.812 -684.104 151.312 -694.104 158.312 -694.104"/></g><g id="node2" class="node"><title>B</title><polygon fill="none" stroke="red" points="430.812 -756 382.812 -756 382.812 -720 436.812 -720 436.812 -750 430.812 -756"/><polyline fill="none" stroke="red" points="430.812 -756 430.812 -750"/><polyline fill="none" stroke="red" points="436.812 -750 430.812 -750"/><text x="409.812" y="-733.8" font-family="Times,serif" font-size="14" text-anchor="middle">B</text></g><g id="node4" class="node"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] start</title><polygon fill="none" stroke="red" points="577.877 -612 241.747 -612 241.747 -576 577.877 -576 577.877 -612"/><text x="409.812" y="-589.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] start</text></g><g id="edge7" class="edge"><title>B-&gt;B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] start</title><path fill="none" stroke="red" d="M409.812,-719.871C409.812,-695.67 409.812,-651.211 409.812,-622.393"/><polygon fill="red" stroke="red" points="413.312 -622.189 409.812 -612.189 406.312 -622.189 413.312 -622.189"/></g><g id="node6" class="node"><title>A: queue +[Foo load]</title><polygon fill="none" stroke="#000" points="223.349 -612 86.275 -612 86.275 -576 223.349 -576 223.349 -612"/><text x="154.812" y="-589.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: queue +[Foo load]</text></g><g id="edge3" class="edge"><title>A: [[NSBundle bundleWithPath:@&quot;Foo&quot;] load] start-&gt;A: queue +[Foo load]</title><path fill="none" stroke="#000" d="M154.812,-647.697C154.812,-639.983 154.812,-630.712 154.812,-622.112"/><polygon fill="#000" stroke="#000" points="158.312 -622.104 154.812 -612.104 151.312 -622.104 158.312 -622.104"/></g><g id="node5" class="node"><title>B: add Foo(B) to #Foo waitqueue</title><polygon fill="none" stroke="red" points="495.909 -540 291.715 -540 291.715 -504 495.909 -504 495.909 -540"/><text x="393.812" y="-517.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: add Foo(B) to #Foo waitqueue</text></g><g id="edge2" class="edge"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] start-&gt;B: add Foo(B) to #Foo waitqueue</title><path fill="none" stroke="red" d="M405.857,-575.697C404.094,-567.983 401.975,-558.712 400.009,-550.112"/><polygon fill="red" stroke="red" points="403.362 -549.073 397.722 -540.104 396.538 -550.633 403.362 -549.073"/></g><g id="node8" class="node"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] end</title><polygon fill="none" stroke="red" points="544.988 -468 212.636 -468 212.636 -432 544.988 -432 544.988 -468"/><text x="378.812" y="-445.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] end</text></g><g id="edge10" class="edge"><title>B: add Foo(B) to #Foo waitqueue-&gt;B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] end</title><path fill="none" stroke="red" d="M390.104,-503.697C388.451,-495.983 386.465,-486.712 384.622,-478.112"/><polygon fill="red" stroke="red" points="387.995 -477.149 382.477 -468.104 381.15 -478.616 387.995 -477.149"/></g><g id="node7" class="node"><title>A: add Foo</title><polygon fill="none" stroke="#000" points="224.312 -540 145.312 -540 145.312 -504 224.312 -504 224.312 -540"/><text x="184.812" y="-517.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: add Foo</text></g><g id="edge4" class="edge"><title>A: queue +[Foo load]-&gt;A: add Foo</title><path fill="none" stroke="#000" d="M162.228,-575.697C165.606,-567.813 169.682,-558.304 173.435,-549.546"/><polygon fill="#000" stroke="#000" points="176.759 -550.675 177.482 -540.104 170.325 -547.917 176.759 -550.675"/></g><g id="node9" class="node"><title>A: run #Foo waitqueue</title><polygon fill="none" stroke="#000" points="313.792 -252 167.832 -252 167.832 -216 313.792 -216 313.792 -252"/><text x="240.812" y="-229.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: run #Foo waitqueue</text></g><g id="edge6" class="edge"><title>A: add Foo-&gt;A: run #Foo waitqueue</title><path fill="none" stroke="#000" d="M188.147,-503.966C197.502,-456.192 224.047,-320.623 235.473,-262.266"/><polygon fill="#000" stroke="#000" points="238.936 -262.793 237.423 -252.306 232.067 -261.448 238.936 -262.793"/></g><g id="node10" class="node"><title>B: [Foo new]</title><polygon fill="none" stroke="red" points="396.975 -396 306.649 -396 306.649 -360 396.975 -360 396.975 -396"/><text x="351.812" y="-373.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: [Foo new]</text></g><g id="edge11" class="edge"><title>B: [[NSBundle bundleWithPath:@&quot;Foo_Bar&quot;] load] end-&gt;B: [Foo new]</title><path fill="none" stroke="red" d="M372.138,-431.697C369.097,-423.813 365.429,-414.304 362.051,-405.546"/><polygon fill="red" stroke="red" points="365.274 -404.175 358.409 -396.104 358.743 -406.694 365.274 -404.175"/></g><g id="node12" class="node"><title>A: add Foo(B)</title><polygon fill="none" stroke="#000" points="289.475 -180 192.149 -180 192.149 -144 289.475 -144 289.475 -180"/><text x="240.812" y="-157.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: add Foo(B)</text></g><g id="edge9" class="edge"><title>A: run #Foo waitqueue-&gt;A: add Foo(B)</title><path fill="none" stroke="#000" d="M240.812,-215.697C240.812,-207.983 240.812,-198.712 240.812,-190.112"/><polygon fill="#000" stroke="#000" points="244.312 -190.104 240.812 -180.104 237.312 -190.104 244.312 -190.104"/></g><g id="node11" class="node"><title>B: [Foo initialize]</title><polygon fill="none" stroke="red" points="356.13 -324 239.494 -324 239.494 -288 356.13 -288 356.13 -324"/><text x="297.812" y="-301.8" font-family="Times,serif" font-size="14" text-anchor="middle">B: [Foo initialize]</text></g><g id="edge12" class="edge"><title>B: [Foo new]-&gt;B: [Foo initialize]</title><path fill="none" stroke="red" d="M338.464,-359.697C332.055,-351.389 324.254,-341.277 317.206,-332.141"/><polygon fill="red" stroke="red" points="319.886 -329.884 311.007 -324.104 314.344 -334.16 319.886 -329.884"/></g><g id="node13" class="node"><title>A: +[Foo load]</title><polygon fill="none" stroke="#000" points="290.921 -108 190.703 -108 190.703 -72 290.921 -72 290.921 -108"/><text x="240.812" y="-85.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: +[Foo load]</text></g><g id="edge13" class="edge"><title>A: add Foo(B)-&gt;A: +[Foo load]</title><path fill="none" stroke="#000" d="M240.812,-143.697C240.812,-135.983 240.812,-126.712 240.812,-118.112"/><polygon fill="#000" stroke="#000" points="244.312 -118.104 240.812 -108.104 237.312 -118.104 244.312 -118.104"/></g><g id="node14" class="node"><title>A: +[Foo(B) load]</title><polygon fill="none" stroke="#000" points="300.084 -36 181.54 -36 181.54 0 300.084 0 300.084 -36"/><text x="240.812" y="-13.8" font-family="Times,serif" font-size="14" text-anchor="middle">A: +[Foo(B) load]</text></g><g id="edge14" class="edge"><title>A: +[Foo load]-&gt;A: +[Foo(B) load]</title><path fill="none" stroke="#000" d="M240.812,-71.6966C240.812,-63.9827 240.812,-54.7125 240.812,-46.1124"/><polygon fill="#000" stroke="#000" points="244.312 -46.104 240.812 -36.104 237.312 -46.104 244.312 -46.104"/></g></g></svg>